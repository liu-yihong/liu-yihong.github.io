<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Understanding BPR, COFISET and BPRH - Yihong Liu&#039;s Blog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Yihong Liu&#039;s Blog"><meta name="msapplication-TileImage" content="/img/logo.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Yihong Liu&#039;s Blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="BPR, COFISET, and BPRH all focus on collaborative filtering with matrix factorization and implicit feedbacks. This task is different from 5-star rating estimation in a sense that only some users’ acti"><meta property="og:type" content="blog"><meta property="og:title" content="Understanding BPR, COFISET and BPRH"><meta property="og:url" content="https://blog.yihong-liu.com/2020/06/26/Understanding-BPR-COFISET-and-BPRH/"><meta property="og:site_name" content="Yihong Liu&#039;s Blog"><meta property="og:description" content="BPR, COFISET, and BPRH all focus on collaborative filtering with matrix factorization and implicit feedbacks. This task is different from 5-star rating estimation in a sense that only some users’ acti"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://blog.yihong-liu.com/images/3mt71MKGjQ0.jpg"><meta property="article:published_time" content="2020-06-27T02:53:11.000Z"><meta property="article:modified_time" content="2022-03-03T02:34:10.439Z"><meta property="article:author" content="Yihong Liu"><meta property="article:tag" content="Ph.D."><meta property="article:tag" content="Research"><meta property="article:tag" content="Personalized Ranking"><meta property="article:tag" content="Implicit Feedback"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://blog.yihong-liu.com/images/3mt71MKGjQ0.jpg"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.yihong-liu.com/2020/06/26/Understanding-BPR-COFISET-and-BPRH/"},"headline":"Understanding BPR, COFISET and BPRH","image":["https://blog.yihong-liu.com/images/3mt71MKGjQ0.jpg"],"datePublished":"2020-06-27T02:53:11.000Z","dateModified":"2022-03-03T02:34:10.439Z","author":{"@type":"Person","name":"Yihong Liu"},"publisher":{"@type":"Organization","name":"Yihong Liu's Blog","logo":{"@type":"ImageObject","url":"https://blog.yihong-liu.com/img/logo.png"}},"description":"BPR, COFISET, and BPRH all focus on collaborative filtering with matrix factorization and implicit feedbacks. This task is different from 5-star rating estimation in a sense that only some users’ acti"}</script><link rel="canonical" href="https://blog.yihong-liu.com/2020/06/26/Understanding-BPR-COFISET-and-BPRH/"><link rel="alternate" href="/atom.xml" title="Yihong Liu&#039;s Blog" type="application/atom+xml"><link rel="icon" href="/img/logo.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><!--!--><meta name="follow.it-verification-code" content="5jAAQWQrk8cqyfwv4Bsh"><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.0.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.png" alt="Yihong Liu&#039;s Blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/about">About</a><a class="navbar-item" href="/miscellaneous">Miscellaneous</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/cv/index/CV-Yihong-Liu.pdf">CV</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="RSS" href="/atom.xml"><i class="fas fa-rss"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="Catalogue" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><div class="card-image"><span class="image is-7by3"><img class="fill" src="/images/3mt71MKGjQ0.jpg" alt="Understanding BPR, COFISET and BPRH"></span></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2020-06-27T02:53:11.000Z" title="6/26/2020, 9:53:11 PM">2020-06-26</time></span><span class="level-item">Updated&nbsp;<time dateTime="2022-03-03T02:34:10.439Z" title="3/2/2022, 8:34:10 PM">2022-03-02</time></span><span class="level-item"><a class="link-muted" href="/categories/Ph-D/">Ph.D.</a><span> / </span><a class="link-muted" href="/categories/Ph-D/Research/">Research</a></span><span class="level-item">26 minutes read (About 3955 words)</span></div></div><h1 class="title is-3 is-size-4-mobile">Understanding BPR, COFISET and BPRH</h1><div class="content"><p>BPR, COFISET, and BPRH all focus on collaborative filtering with matrix factorization and implicit feedbacks. This task is different from 5-star rating estimation in a sense that only some users’ action behaviors (e.g. purchase, view, like, dislike) are available. </p>
<p>This post includes my understanding of these three models.</p>
<span id="more"></span>

<h1 id="TODO"><a href="#TODO" class="headerlink" title="TODO"></a>TODO</h1><ul>
<li><input disabled="" type="checkbox"> BPR</li>
<li><input checked="" disabled="" type="checkbox"> Backgrounds for COFISET</li>
<li><input checked="" disabled="" type="checkbox"> Backgrounds for BPRH</li>
<li><input checked="" disabled="" type="checkbox"> SGD for CIFISET and BPRH</li>
<li><input checked="" disabled="" type="checkbox"> Implementation codes for BPRH in Jupyter Notebook on a small and simple example</li>
<li><input checked="" disabled="" type="checkbox"> Full Implementation codes for BPRH</li>
</ul>
<h1 id="BPR"><a href="#BPR" class="headerlink" title="BPR"></a>BPR</h1><hr>
<div class="notification is-success is-size-6">
 <p style="text-align: center;"><b> UNDER CONSTRUCTION </b></p>
</div>

<h2 id="Implementation"><a href="#Implementation" class="headerlink" title="Implementation"></a>Implementation</h2><p>You may find several verions of BPR implementations below.</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/jokingcoco/BPR_Bayesian-Personalized-Ranking_MPR_Multiple-Pairwise-Ranking">https://github.com/jokingcoco/BPR_Bayesian-Personalized-Ranking_MPR_Multiple-Pairwise-Ranking</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/valerystrizh/bpr">https://github.com/valerystrizh/bpr</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/lyst/lightfm">https://github.com/lyst/lightfm</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/sh0416/bpr">https://github.com/sh0416/bpr</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/guoguibing/librec/search?q=BPR&unscoped_q=BPR">https://github.com/guoguibing/librec/search?q=BPR&unscoped_q&#x3D;BPR</a></li>
</ul>
<h1 id="COFISET"><a href="#COFISET" class="headerlink" title="COFISET"></a>COFISET</h1><hr>
<h2 id="Item-sets-and-Pairwise-Preferences"><a href="#Item-sets-and-Pairwise-Preferences" class="headerlink" title="Item-sets and Pairwise Preferences"></a>Item-sets and Pairwise Preferences</h2>

An item-set is a set of items. A user $u$'s preference over an item-set is a function of $u$'s preferences on items in this item-set. For example, $u$'s preference on item-set $\mathcal{P}$ can be $\hat{r}_{u \mathcal{P}} = |\mathcal{P}|^{-1} \sum_{i \in \mathcal{P}} \hat{r}_{ui}$. $\hat{r}_{ui}$ is $u$'s estimated preference on item $i$.

A user $u$'s pairwise preference  over two item-sets $\mathcal{P}, \mathcal{A}$ is defined as $\hat{r}_{u \mathcal{P} \mathcal{A}} = \hat{r}_{u \mathcal{P}} - \hat{r}_{u \mathcal{A}}$. And in COFISET, the assumption of pairwise preference is $\hat{r}_{u \mathcal{P} \mathcal{A}} = \hat{r}_{u \mathcal{P}} - \hat{r}_{u \mathcal{A}} > 0, \mathcal{P} \subseteq \mathcal{I}^{tr}_{u}, \mathcal{A} \subseteq \mathcal{I}^{tr} \setminus \mathcal{I}^{tr}_{u}$. $\mathcal{P} \subseteq \mathcal{I}^{tr}_{u}$ is a set of items of observed feedback from user $u$ and $\mathcal{A} \subseteq \mathcal{I}^{tr} \setminus \mathcal{I}^{tr}_{u}$ is a set of items without observed feedback from user $u$.



<h2 id="Objective-Function-and-Optimization"><a href="#Objective-Function-and-Optimization" class="headerlink" title="Objective Function and Optimization"></a>Objective Function and Optimization</h2><p>COFISET’s relaxed optimization for all users is </p>


$$ \min_{\Theta} \sum_{u \in \mathcal{U}^{tr}} \sum_{\mathcal{P} \subseteq \mathcal{I}_{u}^{tr}} \sum_{\mathcal{A} \subseteq \mathcal{I} \setminus \mathcal{I}_{u}^{tr}} \left[ \mathcal{L}(u, \mathcal{P}, \mathcal{A}) + \mathcal{R}(u, \mathcal{P}, \mathcal{A}) \right]  $$
, where $\Theta = \{ U_{u} \in \mathbb{R}^{ d \times 1}, V_{i} \in \mathbb{R}^{d \times 1}, b_i \in \mathbb{R}, u \in \mathcal{U}^{tr}, i \in \mathcal{I}^{tr} \}$ is the set of model parameter, the loss term $\mathcal{L}(u, \mathcal{P}, \mathcal{A}) = - \ln{\sigma(\hat{r}_{u\mathcal{P}\mathcal{A}})}$, $\sigma(z) = 1/(1+\exp{(-z)})$, the pairwise preferences of user $u$ across 2 item-sets $\mathcal{P}$ and $\mathcal{A}$ is $\hat{r}_{u\mathcal{P}\mathcal{A}} = \hat{r}_{u\mathcal{P}} - \hat{r}_{u\mathcal{A}}$, the estimated preferences of user $u$ on item-sets $\mathcal{P}$ and $\mathcal{A}$ are $\hat{r}_{u\mathcal{P}} = |P|^{-1} \sum_{i \in \mathcal{P}} \hat{r}_{ui}, \hat{r}_{u\mathcal{A}} = |A|^{-1} \sum_{j \in \mathcal{A}} \hat{r}_{uj}$, the estimated preference of user $u$ on item $i$ is $\hat{r}_{ui} = U_{u}^\top V_{i} + b_i$, and the regularization term $\mathcal{R}(u, \mathcal{P}, \mathcal{A}) = \frac{\alpha_u}{2} \| U_u \|^2 + \sum_{i \in \mathcal{P}} [\frac{\alpha_V}{2} \| V_i \|^2 + \frac{\beta_V}{2} b_i^2] + \sum_{j \in \mathcal{A}} [\frac{\alpha_V}{2} \| V_j \|^2 + \frac{\beta_V}{2} b_j^2]$.



<h2 id="Corresponding-Gradients-in-SGD"><a href="#Corresponding-Gradients-in-SGD" class="headerlink" title="Corresponding Gradients in SGD"></a>Corresponding Gradients in SGD</h2><p>Stochastic gradient descent is applied in COFISET’s optimization. The corresponding gradients of model parameter $\Theta$ w.r.t. $\mathcal{L}(u, \mathcal{P}, \mathcal{A})$ and $\mathcal{R}(u, \mathcal{P}, \mathcal{A})$ are</p>


$$ \begin{aligned} 
\dfrac{\partial \mathcal{L}}{\partial U_{u}} & = - \dfrac{\partial \ln \sigma}{\partial \sigma} \dfrac{\partial \sigma}{\partial \hat{r}_{u \mathcal{P} \mathcal{A}} } \dfrac{\partial \hat{r}_{u \mathcal{P} \mathcal{A}}}{\partial U_{u}} \\ 
& = - \sigma^{-1}(-\hat{r}_{u \mathcal{P} \mathcal{A}}) \sigma(-\hat{r}_{u \mathcal{P} \mathcal{A}}) (1-\sigma(-\hat{r}_{u \mathcal{P} \mathcal{A}})) \dfrac{\partial (\hat{r}_{u\mathcal{P}} - \hat{r}_{u\mathcal{A}}) }{\partial U_{u}}\\ 
& = - \sigma(-\hat{r}_{u \mathcal{P} \mathcal{A}}) (|\mathcal{P}|^{-1} \sum_{i \in \mathcal{P}} V_{i} - |\mathcal{A}|^{-1} \sum_{j \in \mathcal{A}} V_{j} ) \\
& = - \sigma(-\hat{r}_{u \mathcal{P} \mathcal{A}}) (\overline{V}_{\mathcal{P}} - \overline{V}_{\mathcal{A}}), \forall u \in \mathcal{U}^{tr} \\ 
\dfrac{\partial \mathcal{R}}{\partial U_u} & = \alpha_{u} U_{u}, \forall u \in \mathcal{U}^{tr} \\
\end{aligned} $$






$$\begin{aligned}

\dfrac{\partial \mathcal{L}}{\partial V_{i}} & = - \dfrac{\partial \ln \sigma}{\partial \sigma} \dfrac{\partial \sigma}{\partial \hat{r}_{u \mathcal{P} \mathcal{A}} } \dfrac{\partial \hat{r}_{u \mathcal{P} \mathcal{A}}}{\partial V_{i}} \\ 
& = - \sigma^{-1}(-\hat{r}_{u \mathcal{P} \mathcal{A}}) \sigma(-\hat{r}_{u \mathcal{P} \mathcal{A}}) (1-\sigma(-\hat{r}_{u \mathcal{P} \mathcal{A}})) \dfrac{\partial (\hat{r}_{u\mathcal{P}} - \hat{r}_{u\mathcal{A}}) }{\partial V_{i}}\\ 
& = - \sigma(-\hat{r}_{u \mathcal{P} \mathcal{A}}) (U_{u} / |\mathcal{P}|), \forall i \in \mathcal{P} \\
\dfrac{\partial \mathcal{R}}{\partial V_i} & = \alpha_{V} V_{i}, \forall i \in \mathcal{P} \\
\dfrac{\partial \mathcal{L}}{\partial b_i} & = - \dfrac{\partial \ln \sigma}{\partial \sigma} \dfrac{\partial \sigma}{\partial \hat{r}_{u \mathcal{P} \mathcal{A}} } \dfrac{\partial \hat{r}_{u \mathcal{P} \mathcal{A}}}{\partial b_{i}} \\ 
& = - \sigma^{-1}(-\hat{r}_{u \mathcal{P} \mathcal{A}}) \sigma(-\hat{r}_{u \mathcal{P} \mathcal{A}}) (1-\sigma(-\hat{r}_{u \mathcal{P} \mathcal{A}})) \dfrac{\partial (\hat{r}_{u\mathcal{P}} - \hat{r}_{u\mathcal{A}}) }{\partial b_{i}}\\ 
& = - \sigma(-\hat{r}_{u \mathcal{P} \mathcal{A}}) / |\mathcal{P}|, \forall i \in \mathcal{P} \\
\dfrac{\partial \mathcal{R}}{\partial b_i} & = \beta_V b_{i}, \forall i \in \mathcal{P} \\
\end{aligned} $$





$$\begin{aligned}

\dfrac{\partial \mathcal{L}}{\partial V_j} & = - \dfrac{\partial \ln \sigma}{\partial \sigma} \dfrac{\partial \sigma}{\partial \hat{r}_{u \mathcal{P} \mathcal{A}} } \dfrac{\partial \hat{r}_{u \mathcal{P} \mathcal{A}}}{\partial V_{j}} \\ 
& = - \sigma^{-1}(-\hat{r}_{u \mathcal{P} \mathcal{A}}) \sigma(-\hat{r}_{u \mathcal{P} \mathcal{A}}) (1-\sigma(-\hat{r}_{u \mathcal{P} \mathcal{A}})) \dfrac{\partial (\hat{r}_{u\mathcal{P}} - \hat{r}_{u\mathcal{A}}) }{\partial V_{j}}\\ 
& = \sigma(-\hat{r}_{u \mathcal{P} \mathcal{A}}) (U_{u} / |\mathcal{A}|), \forall j \in \mathcal{A} \\
\dfrac{\partial \mathcal{R}}{\partial V_j} & = \alpha_{V} V_{j}, \forall j \in \mathcal{A} \\
\dfrac{\partial \mathcal{L}}{\partial b_j} & = - \dfrac{\partial \ln \sigma}{\partial \sigma} \dfrac{\partial \sigma}{\partial \hat{r}_{u \mathcal{P} \mathcal{A}} } \dfrac{\partial \hat{r}_{u \mathcal{P} \mathcal{A}}}{\partial b_{j}} \\ 
& = - \sigma^{-1}(-\hat{r}_{u \mathcal{P} \mathcal{A}}) \sigma(-\hat{r}_{u \mathcal{P} \mathcal{A}}) (1-\sigma(-\hat{r}_{u \mathcal{P} \mathcal{A}})) \dfrac{\partial (\hat{r}_{u\mathcal{P}} - \hat{r}_{u\mathcal{A}}) }{\partial b_{j}}\\ 
& = \sigma(-\hat{r}_{u \mathcal{P} \mathcal{A}}) / |\mathcal{A}|, \forall j \in \mathcal{A} \\
\dfrac{\partial \mathcal{R}}{\partial b_j} & = \beta_{V} b_{j}, \forall j \in \mathcal{A}
\end{aligned} $$



<h3 id="Updating-Rules"><a href="#Updating-Rules" class="headerlink" title="Updating Rules"></a>Updating Rules</h3><p>Combining the gradients w.r.t. the loss term and the regularization term, the final gradients for each variable $U_{u}, V_{i}, V_{j}, b_{i}, b_{j}, u \in \mathcal{U}^{tr}, i \in \mathcal{P}, j \in \mathcal{A}$ are</p>


$$ \begin{aligned}
	\nabla U_{u} & = \dfrac{\partial \mathcal{L}}{\partial U_{u}} + \dfrac{\partial \mathcal{R}}{\partial U_{u}} \\ & = - \sigma(-\hat{r}_{u \mathcal{P} \mathcal{A}}) (\overline{V}_{\mathcal{P}} - \overline{V}_{\mathcal{A}}) + \alpha_{u} U_{u} \\
	\nabla V_{i} & = \dfrac{\partial \mathcal{L}}{\partial V_{i}} + \dfrac{\partial \mathcal{R}}{\partial V_{i}} \\ & = - \sigma(-\hat{r}_{u \mathcal{P} \mathcal{A}}) (U_{u} / |\mathcal{P}|) + \alpha_{V} V_{i} \\
	\nabla V_{j} & = \dfrac{\partial \mathcal{L}}{\partial V_{j}} + \dfrac{\partial \mathcal{R}}{\partial V_{j}} \\ & = \sigma(-\hat{r}_{u \mathcal{P} \mathcal{A}}) (U_{u} / |\mathcal{A}|) + \alpha_{V} V_{j} \\
	\nabla b_{i} & = \dfrac{\partial \mathcal{L}}{\partial b_{i}} + \dfrac{\partial \mathcal{R}}{\partial b_{i}} \\ & = - \sigma(-\hat{r}_{u \mathcal{P} \mathcal{A}}) / |\mathcal{P}| + \beta_V b_{i}\\ 
	\nabla b_{j} & = \dfrac{\partial \mathcal{L}}{\partial b_{j}} + \dfrac{\partial \mathcal{R}}{\partial b_{j}} \\ & = \sigma(-\hat{r}_{u \mathcal{P} \mathcal{A}}) / |\mathcal{A}| + \beta_{V} b_{j}
\end{aligned} $$
And the updating rules for each variable are

$$ \begin{aligned}
U_{u}^{t+1} & = U_{u}^{t} - \gamma \nabla U_{u}^{t}, u \in \mathcal{U}^{tr} \\
V_{i}^{t+1} & = V_{i}^{t} - \gamma \nabla V_{i}^{t}, i \in \mathcal{P} \\
V_{j}^{t+1} & = V_{j}^{t} - \gamma \nabla V_{j}^{t}, j \in \mathcal{A} \\
b_{i}^{t+1} & = b_{i}^{t} - \gamma \nabla b_{i}^{t}, i \in \mathcal{P} \\ 
b_{j}^{t+1} & = b_{j}^{t} - \gamma \nabla b_{j}^{t}, j \in \mathcal{A}
\end{aligned} $$



<h2 id="JAVA-Implementation"><a href="#JAVA-Implementation" class="headerlink" title="JAVA Implementation"></a>JAVA Implementation</h2><p>You may find the implementation of COFISET in this famous JAVA library of recommendation systems <a target="_blank" rel="noopener" href="https://github.com/guoguibing/librec/search?q=COFISET&unscoped_q=COFISET">LibRec</a>.</p>
<h1 id="BPRH"><a href="#BPRH" class="headerlink" title="BPRH"></a>BPRH</h1><hr>
<h2 id="Extended-Pairwise-Preferences"><a href="#Extended-Pairwise-Preferences" class="headerlink" title="Extended Pairwise Preferences"></a>Extended Pairwise Preferences</h2>

Following COFISET, BPRH extends the pairwise preferences over item-sets. Besides the target action (e.g. purchase), a type of user's action called auxiliary action is introduced. Viewing, liking, and disliking are examples for auxiliary actions. Now the assumption of pairwise preferences in BPRH becomes $\hat{r}_{u \mathcal{I}} > \hat{r}_{u \mathcal{J}} > \hat{r}_{u \mathcal{K}}, \mathcal{I} \subseteq \mathcal{I}_{t}^{u}, \mathcal{J} \subseteq \mathcal{I}_{t}^{oa}, \mathcal{K} \subseteq \mathcal{I}_{n}^{u}$. $\mathcal{I} \subseteq \mathcal{I}_{t}^{u}$ is a set of items with target feedback from user $u$. $\mathcal{J} \subseteq \mathcal{I}_{t}^{oa}$ is a set of items with only auxiliary feedback from user $u$. And $\mathcal{K} \subseteq \mathcal{I}_{n}^{u}$ is a set of items without any observed feedback from user $u$. Then we can get $\hat{r}_{u\mathcal{I}\mathcal{J}} > 0, \hat{r}_{u\mathcal{J}\mathcal{K}} > 0$ for user $u$.



<h2 id="Objective-Function-and-Optimization-1"><a href="#Objective-Function-and-Optimization-1" class="headerlink" title="Objective Function and Optimization"></a>Objective Function and Optimization</h2><p>BPRH reaches the maximization for all users $u$ as </p>


	
	$$ \begin{aligned}
		\max_{\Theta} \quad & f(\Theta) - \mathcal{R}(\Theta)
	\end{aligned}$$
	, where $f(\Theta) = \sum_{u \in U} \left\lbrace \sum_{ \mathcal{I} \subseteq I^{u}_{t}, \mathcal{J} \subseteq I^{u}_{oa} } {\ln \sigma \left( \dfrac{\hat{r}_{u \mathcal{I} \mathcal{J}} (\Theta) }{\alpha_{u}} \right) } + \sum_{ \mathcal{J} \subseteq I^{u}_{oa}, \mathcal{K} \subseteq I^{u}_{n}} {\ln \sigma \left( \hat{r}_{u \mathcal{J} \mathcal{K}} (\Theta) \right) } \right\rbrace$ is the negative value of loss term, $\Theta = \{ U_{u} \in \mathbb{R}^{1 \times d}, V_{i} \in \mathbb{R}^{1 \times d}, b_i \in \mathbb{R}, u \in \mathcal{U}, i \in I \}$ is the set of model parameter, the pairwise preference of user $u$ across 2 item-sets $\mathcal{I}$ and $\mathcal{J}$ is $\hat{r}_{u\mathcal{I}\mathcal{J}} = \hat{r}_{u\mathcal{I}} - \hat{r}_{u\mathcal{J}}$,the pairwise preference of user $u$ across 2 item-sets $\mathcal{J}$ and $\mathcal{K}$ is $\hat{r}_{u\mathcal{J}\mathcal{K}} = \hat{r}_{u\mathcal{J}} - \hat{r}_{u\mathcal{K}}$, the estimated preferences of user $u$ on item-sets $\mathcal{I}, \mathcal{J}, \mathcal{K}$ are $\hat{r}_{u\mathcal{I}} = |I|^{-1} \sum_{i \in \mathcal{I}} \hat{r}_{ui}$, $ \hat{r}_{u\mathcal{J}} = |J|^{-1} \sum_{j \in \mathcal{J}} \hat{r}_{uj}$, $\hat{r}_{u\mathcal{K}} = |K|^{-1} \sum_{k \in \mathcal{K}} \hat{r}_{uk}$, the estimated preference of user $u$ on item $i$ is $\hat{r}_{ui} = U_{u}^\top V_{i} + b_i$, and the regularization term $$ \begin{aligned}
		\mathcal{R}(\Theta) = \sum_{u \in U} \sum_{\mathcal{I} \subseteq I^{u}_{t}, \mathcal{J} \subseteq I^{u}_{oa}, \mathcal{K} \subseteq I^{u}_{n}} \{ & \lambda_u \| U_{u} \|^2  \\ & + \lambda_v \left( \| V_{\mathcal{I}} \|^2 + \| V_{\mathcal{J}} \|^2 + \| V_{\mathcal{K}} \|^2 \right) \\ & + \lambda_b \left( b_{\mathcal{I}}^2 + b_{\mathcal{J}}^2 + b_{\mathcal{K}}^2 \right) \}
	\end{aligned}  $$, $V_{\mathcal{I}} = |\mathcal{I}|^{-1} \sum_{i \in \mathcal{I}} V_i$, $V_{\mathcal{J}} = |\mathcal{J}|^{-1} \sum_{j \in \mathcal{J}} V_j$, $V_{\mathcal{K}} = |\mathcal{K}|^{-1} \sum_{k \in \mathcal{K}} V_k$, $b_{\mathcal{I}} = |\mathcal{I}|^{-1} \sum_{i \in \mathcal{I}} b_i$, $b_{\mathcal{J}} = |\mathcal{J}|^{-1} \sum_{j \in \mathcal{J}} b_j$, $b_{\mathcal{K}} = |\mathcal{K}|^{-1} \sum_{k \in \mathcal{K}} b_k$. $\alpha_{u}$ is a parameter in $f(\Theta)$ controlling the contribution of $\hat{r}_{u \mathcal{I} \mathcal{J}} (\Theta)$ and calculated from data.
	


<h2 id="Corresponding-Gradients-in-SGD-1"><a href="#Corresponding-Gradients-in-SGD-1" class="headerlink" title="Corresponding Gradients in SGD"></a>Corresponding Gradients in SGD</h2><p>Stochastic gradient descent is utilized in optimization. The corresponding gradients of model parameter $\Theta$ w.r.t the negative loss term $f(\Theta)$ and the regularization term $\mathcal{R}(\Theta)$ are</p>


$$\begin{aligned}
		\dfrac{\partial f}{\partial U_{u}} & = \dfrac{\partial \ln(\sigma)}{\partial \sigma} \dfrac{\partial \sigma(\hat{r}_{u\mathcal{I}\mathcal{J}} / \alpha_{u} )  }{\partial \hat{r}_{u\mathcal{I}\mathcal{J}} / \alpha_{u} } \dfrac{\partial \hat{r}_{u\mathcal{I}\mathcal{J}} / \alpha_{u} }{\partial U_{u}} + \dfrac{\partial \ln(\sigma)}{\partial \sigma} \dfrac{\partial \sigma(\hat{r}_{u\mathcal{J}\mathcal{K}})}{\partial \hat{r}_{u\mathcal{J}\mathcal{K}} } \dfrac{\partial \hat{r}_{u\mathcal{J}\mathcal{K}} }{\partial U_{u}} \\ & = \alpha_{u}^{-1} \sigma(- \alpha_{u}^{-1} \hat{r}_{u\mathcal{I}\mathcal{J}} ) \left[ |I|^{-1} \sum_{i \in \mathcal{I}} V_{i} - |J|^{-1} \sum_{j \in \mathcal{J}} V_{j} \right] \\ & + \sigma(- \hat{r}_{u\mathcal{J}\mathcal{K}} ) \left[ |J|^{-1} \sum_{j \in \mathcal{J}} V_{j} - |K|^{-1} \sum_{k \in \mathcal{K}} V_{k} \right] \\ & = \alpha_{u}^{-1} \sigma(- \alpha_{u}^{-1} \hat{r}_{u\mathcal{I}\mathcal{J}} ) \left[ \overline{V}_{\mathcal{I}} - \overline{V}_{\mathcal{J}} \right] + \sigma(- \hat{r}_{u\mathcal{J}\mathcal{K}} ) \left[ \overline{V}_{\mathcal{J}} - \overline{V}_{\mathcal{K}} \right], \forall u \in U \\
		\dfrac{\partial \mathcal{R}}{\partial U_{u}} & = 2 \lambda_{u} U_{u}, \forall u \in U\\
\end{aligned}$$

$$\begin{aligned}
		\dfrac{\partial f}{\partial V_{i}} & = \dfrac{\partial \ln(\sigma)}{\partial \sigma} \dfrac{\partial \sigma(\hat{r}_{u\mathcal{I}\mathcal{J}} / \alpha_{u} )  }{\partial \hat{r}_{u\mathcal{I}\mathcal{J}} / \alpha_{u} } \dfrac{\partial \hat{r}_{u\mathcal{I}\mathcal{J}} / \alpha_{u} }{\partial V_{i}} \\ & = (|\mathcal{I}| \alpha_{u})^{-1} \sigma(- \alpha_u^{-1} \hat{r}_{u\mathcal{I}\mathcal{J}} ) U_{u}, \forall i \in \mathcal{I}\\
		\dfrac{\partial \mathcal{R}}{\partial V_{i}} & = \lambda_{v} \dfrac{\partial \| V_{\mathcal{I}} \|^2 }{\partial V_{\mathcal{I}}} \dfrac{\partial V_{\mathcal{I}}}{\partial V_{i}} = 2 |\mathcal{I}|^{-1} \lambda_{v} V_{\mathcal{I}}, \forall i \in \mathcal{I} \\
		\dfrac{\partial f}{\partial b_{i}} & = \dfrac{\partial \ln(\sigma)}{\partial \sigma} \dfrac{\partial \sigma(\hat{r}_{u\mathcal{I}\mathcal{J}} / \alpha_{u} )  }{\partial \hat{r}_{u\mathcal{I}\mathcal{J}} / \alpha_{u} } \dfrac{\partial \hat{r}_{u\mathcal{I}\mathcal{J}} / \alpha_{u} }{\partial b_{i}} \\ & = (|\mathcal{I}| \alpha_{u})^{-1} \sigma(- \alpha_u^{-1} \hat{r}_{u\mathcal{I}\mathcal{J}} ), \forall i \in \mathcal{I}\\
		\dfrac{\partial \mathcal{R}}{\partial b_{i}} & = \lambda_b \dfrac{\partial b_{\mathcal{I}}^2 }{\partial b_{\mathcal{I}}} \dfrac{\partial b_{\mathcal{I}}}{\partial b_{i}} = 2 \lambda_b |\mathcal{I}|^{-1} b_{\mathcal{I}}, \forall i \in \mathcal{I} \\ 
\end{aligned}$$
$$\begin{aligned}
		\dfrac{\partial f}{\partial V_{j}} & = \dfrac{\partial \ln(\sigma)}{\partial \sigma} \dfrac{\partial \sigma(\hat{r}_{u\mathcal{I}\mathcal{J}} / \alpha_{u} )  }{\partial \hat{r}_{u\mathcal{I}\mathcal{J}} / \alpha_{u} } \dfrac{\partial \hat{r}_{u\mathcal{I}\mathcal{J}} / \alpha_{u} }{\partial V_{j} } + \dfrac{\partial \ln(\sigma)}{\partial \sigma} \dfrac{\partial \sigma(\hat{r}_{u\mathcal{J}\mathcal{K}})}{\partial \hat{r}_{u\mathcal{J}\mathcal{K}} } \dfrac{\partial \hat{r}_{u\mathcal{J}\mathcal{K}} }{\partial V_{j}} \\ & = - ( |\mathcal{J}| \alpha_{u})^{-1} \sigma(- \alpha_{u}^{-1} \hat{r}_{u\mathcal{I}\mathcal{J}} ) U_{u} + |\mathcal{J}|^{-1} \sigma(- \hat{r}_{u\mathcal{J}\mathcal{K}} ) U_{u} \\ & = |\mathcal{J}|^{-1} \left[ - \alpha_{u}^{-1} \sigma(- \alpha_{u}^{-1} \hat{r}_{u\mathcal{I}\mathcal{J}} ) + \sigma(- \hat{r}_{u\mathcal{J}\mathcal{K}} ) \right] U_{u}, \forall j \in \mathcal{J} \\
		\dfrac{\partial \mathcal{R}}{\partial V_{j}} & = \lambda_{v} \dfrac{\partial \| V_{\mathcal{J}} \|^2 }{\partial V_{\mathcal{J}}} \dfrac{\partial V_{\mathcal{J}}}{\partial V_{j}} = 2 |\mathcal{J}|^{-1} \lambda_{v} V_{\mathcal{J}}, \forall j \in \mathcal{J}  \\
		\dfrac{\partial f}{\partial b_{j}} & = \dfrac{\partial \ln(\sigma)}{\partial \sigma} \dfrac{\partial \sigma(\hat{r}_{u\mathcal{I}\mathcal{J}} / \alpha_{u} )  }{\partial \hat{r}_{u\mathcal{I}\mathcal{J}} / \alpha_{u} } \dfrac{\partial \hat{r}_{u\mathcal{I}\mathcal{J}} / \alpha_{u} }{\partial b_{j} } + \dfrac{\partial \ln(\sigma)}{\partial \sigma} \dfrac{\partial \sigma(\hat{r}_{u\mathcal{J}\mathcal{K}})}{\partial \hat{r}_{u\mathcal{J}\mathcal{K}} } \dfrac{\partial \hat{r}_{u\mathcal{J}\mathcal{K}} }{\partial b_{j}} \\ & = - ( |\mathcal{J}| \alpha_{u})^{-1} \sigma(- \alpha_{u}^{-1} \hat{r}_{u\mathcal{I}\mathcal{J}} ) + |\mathcal{J}|^{-1} \sigma(- \hat{r}_{u\mathcal{J}\mathcal{K}} ) \\ & = |\mathcal{J}|^{-1} \left[ - \alpha_{u}^{-1} \sigma(- \alpha_{u}^{-1} \hat{r}_{u\mathcal{I}\mathcal{J}} ) + \sigma(- \hat{r}_{u\mathcal{J}\mathcal{K}} ) \right], \forall j \in \mathcal{J} \\
		\dfrac{\partial \mathcal{R}}{\partial b_{j}} & = \lambda_b \dfrac{\partial b_{\mathcal{J}}^2 }{\partial b_{\mathcal{J}}} \dfrac{\partial b_{\mathcal{J}}}{\partial b_{j}} = 2 \lambda_b |\mathcal{J}|^{-1} b_{\mathcal{J}}, \forall j \in \mathcal{J} \\
\end{aligned}$$
$$\begin{aligned}
		\dfrac{\partial f}{\partial V_{k}} & = \dfrac{\partial \ln(\sigma)}{\partial \sigma} \dfrac{\partial \sigma(\hat{r}_{u\mathcal{J}\mathcal{K}})  }{\partial \hat{r}_{u\mathcal{J}\mathcal{K}}} \dfrac{\partial \hat{r}_{u\mathcal{J}\mathcal{K}} }{\partial V_{k}} \\ & = - |\mathcal{K}|^{-1} \sigma(- \hat{r}_{u\mathcal{J}\mathcal{K}} ) U_{u}, \forall k \in \mathcal{K}\\
		\dfrac{\partial \mathcal{R}}{\partial V_{k}} & = \lambda_{v} \dfrac{\partial \| V_{\mathcal{K}} \|^2 }{\partial V_{\mathcal{K}}} \dfrac{\partial V_{\mathcal{K}}}{\partial V_{k}} = 2 |\mathcal{K}|^{-1} \lambda_{v} V_{\mathcal{K}}, \forall k \in \mathcal{K}\\
		\dfrac{\partial f}{\partial b_{k}} & = \dfrac{\partial \ln(\sigma)}{\partial \sigma} \dfrac{\partial \sigma(\hat{r}_{u\mathcal{J}\mathcal{K}} )  }{\partial \hat{r}_{u\mathcal{J}\mathcal{K}}  } \dfrac{\partial \hat{r}_{u\mathcal{J}\mathcal{K}}  }{\partial b_{k}} \\ & = - |\mathcal{K}|^{-1} \sigma(- \hat{r}_{u\mathcal{J}\mathcal{K}} ), \forall k \in \mathcal{K}\\
		\dfrac{\partial \mathcal{R}}{\partial b_{k}} & = \lambda_b \dfrac{\partial b_{\mathcal{K}}^2 }{\partial b_{\mathcal{K}}} \dfrac{\partial b_{\mathcal{K}}}{\partial b_{k}} = 2 \lambda_b |\mathcal{K}|^{-1} b_{\mathcal{K}}, \forall k \in \mathcal{K}\\
\end{aligned}$$



<h3 id="Updating-Rules-1"><a href="#Updating-Rules-1" class="headerlink" title="Updating Rules"></a>Updating Rules</h3><p>Combining the gradients w.r.t. the negative loss term and the regularization term, the final gradients for each variable $U_{u}, V_{i}, V_{j}, V_{k}, b_{i}, b_{j}, b_{k}, u \in U, i \in \mathcal{I}, j \in \mathcal{J}, k \in \mathcal{K}$ are</p>


$$ \begin{aligned}
	\nabla U_{u} & = \dfrac{\partial f}{\partial U_{u}} - \dfrac{\partial \mathcal{R}}{\partial U_{u}} \\ & = \alpha_{u}^{-1} \sigma(- \alpha_{u}^{-1} \hat{r}_{u\mathcal{I}\mathcal{J}} ) \left[ \overline{V}_{\mathcal{I}} - \overline{V}_{\mathcal{J}} \right] + \sigma(- \hat{r}_{u\mathcal{J}\mathcal{K}} ) \left[ \overline{V}_{\mathcal{J}} - \overline{V}_{\mathcal{K}} \right] - 2 \lambda_{u} U_{u}, \forall u \in U \\
	\nabla V_{i} & = \dfrac{\partial f}{\partial V_{i}} - \dfrac{\partial \mathcal{R}}{\partial V_{i}} \\ & = (|\mathcal{I}| \alpha_{u})^{-1} \sigma(- \alpha_u^{-1} \hat{r}_{u\mathcal{I}\mathcal{J}} ) U_{u} - 2 |\mathcal{I}|^{-1} \lambda_{v} V_{\mathcal{I}}, \forall i \in \mathcal{I}\\
	\nabla V_{j} & = \dfrac{\partial f}{\partial V_{j}} - \dfrac{\partial \mathcal{R}}{\partial V_{j}} \\ & = |\mathcal{J}|^{-1} \left[ - \alpha_{u}^{-1} \sigma(- \alpha_{u}^{-1} \hat{r}_{u\mathcal{I}\mathcal{J}} ) + \sigma(- \hat{r}_{u\mathcal{J}\mathcal{K}} ) \right] U_{u} - 2 |\mathcal{J}|^{-1} \lambda_{v} V_{\mathcal{J}}, \forall j \in \mathcal{J}\\
	\nabla V_{k} & = \dfrac{\partial f}{\partial V_{k}} - \dfrac{\partial \mathcal{R}}{\partial V_{k}} \\ & = - |\mathcal{K}|^{-1} \sigma(- \hat{r}_{u\mathcal{J}\mathcal{K}} ) U_{u} - 2 |\mathcal{K}|^{-1} \lambda_{v} V_{\mathcal{K}}, \forall k \in \mathcal{K}\\
	\nabla b_{i} & = \dfrac{\partial f}{\partial b_{i}} - \dfrac{\partial \mathcal{R}}{\partial b_{i}} \\ & = (|\mathcal{I}| \alpha_{u})^{-1} \sigma(- \alpha_u^{-1} \hat{r}_{u\mathcal{I}\mathcal{J}} ) - 2 \lambda_b |\mathcal{I}|^{-1} b_{\mathcal{I}}, \forall i \in \mathcal{I}\\ 
	\nabla b_{j} & = \dfrac{\partial f}{\partial b_{j}} - \dfrac{\partial \mathcal{R}}{\partial b_{j}} \\ & = |\mathcal{J}|^{-1} \left[ - \alpha_{u}^{-1} \sigma(- \alpha_{u}^{-1} \hat{r}_{u\mathcal{I}\mathcal{J}} ) + \sigma(- \hat{r}_{u\mathcal{J}\mathcal{K}} ) \right] - 2 \lambda_b |\mathcal{J}|^{-1} b_{\mathcal{J}}, \forall j \in \mathcal{J}\\
	\nabla b_{k} & = \dfrac{\partial f}{\partial b_{k}} - \dfrac{\partial \mathcal{R}}{\partial b_{k}} \\ & = - |\mathcal{K}|^{-1} \sigma(- \hat{r}_{u\mathcal{J}\mathcal{K}} ) - 2 \lambda_b |\mathcal{K}|^{-1} b_{\mathcal{K}}, \forall k \in \mathcal{K}\\
	\end{aligned} $$
	
	And the updating rules for each variable are
	
	$$ \begin{aligned}
	U_{u}^{t+1} & = U_{u}^{t} + \gamma \nabla U_{u}^{t}, u \in U \\
	V_{i}^{t+1} & = V_{i}^{t} + \gamma \nabla V_{i}^{t}, i \in \mathcal{I} \\
	V_{j}^{t+1} & = V_{j}^{t} + \gamma \nabla V_{j}^{t}, j \in \mathcal{J} \\
	V_{k}^{t+1} & = V_{k}^{t} + \gamma \nabla V_{k}^{t}, k \in \mathcal{K} \\
	b_{i}^{t+1} & = b_{i}^{t} + \gamma \nabla b_{i}^{t}, i \in \mathcal{I} \\ 
	b_{j}^{t+1} & = b_{j}^{t} + \gamma \nabla b_{j}^{t}, j \in \mathcal{J} \\
	b_{k}^{t+1} & = b_{k}^{t} + \gamma \nabla b_{k}^{t}, k \in \mathcal{K}
	\end{aligned} $$



<h2 id="Online-Updating-for-New-User"><a href="#Online-Updating-for-New-User" class="headerlink" title="Online Updating for New User"></a>Online Updating for New User</h2><p>Rendle et al (2008) came with an online updating schema in their regularized kernal matrix factorization model along with stochastic gradient descent. Since BPRH also utilizes SGD in its objective function maximization, we can follow Rendle’s methods to update user and item matrices when a new user or item enters the landscape (cold-start problem). You can see the implementation code at <a target="_blank" rel="noopener" href="https://github.com/liu-yihong/BPRH/blob/master/bprH_gpu.py#L656">bprH_gpu.py - Line 656</a>.</p>
<img src="/2020/06/26/Understanding-BPR-COFISET-and-BPRH/BPRH-online-updating-min.png" class="" title="BPRH User Online Updating Scheme">

<h2 id="Python-Implementation"><a href="#Python-Implementation" class="headerlink" title="Python Implementation"></a>Python Implementation</h2><p>You can star my BPRH repository and see the details of my BPRH implementation at </p>
<p><a target="_blank" rel="noopener" href="https://github.com/liu-yihong/BPRH"><img src="https://github-readme-stats.vercel.app/api/pin/?username=liu-yihong&repo=BPRH&show_owner=true" alt="BPRH Python Implementation"></a></p>
<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ol>
<li>Rendle, Steffen, et al. “BPR: Bayesian personalized ranking from implicit feedback.” arXiv preprint arXiv:1205.2618 (2012). <a target="_blank" rel="noopener" href="https://arxiv.org/abs/1205.2618">link</a></li>
<li>Pan, Weike, and Li Chen. “Cofiset: Collaborative filtering via learning pairwise preferences over item-sets.” Proceedings of the 2013 SIAM international conference on data mining. Society for Industrial and Applied Mathematics, 2013. <a target="_blank" rel="noopener" href="https://epubs.siam.org/doi/abs/10.1137/1.9781611972832.20">link</a></li>
<li>Qiu, Huihuai, et al. “BPRH: Bayesian personalized ranking for heterogeneous implicit feedback.” Information Sciences 453 (2018): 80-98. <a target="_blank" rel="noopener" href="https://www.sciencedirect.com/science/article/pii/S0020025516315742">link</a></li>
<li>Rendle, Steffen, and Lars Schmidt-Thieme. “Online-updating regularized kernel matrix factorization models for large-scale recommender systems.” Proceedings of the 2008 ACM conference on Recommender systems. 2008. <a target="_blank" rel="noopener" href="https://dl.acm.org/doi/abs/10.1145/1454008.1454047">link</a></li>
</ol>
</div><div class="article-licensing box"><div class="licensing-title"><p>Understanding BPR, COFISET and BPRH</p><p><a href="https://blog.yihong-liu.com/2020/06/26/Understanding-BPR-COFISET-and-BPRH/">https://blog.yihong-liu.com/2020/06/26/Understanding-BPR-COFISET-and-BPRH/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>Yihong Liu</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2020-06-26</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>2022-03-02</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="NonCommercial 4.0 International" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a><a class="icons" rel="noopener" target="_blank" title="ShareAlike 4.0 International" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><i class="icon fab fa-creative-commons-sa"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/Ph-D/">Ph.D.</a><a class="link-muted mr-2" rel="tag" href="/tags/Research/">Research</a><a class="link-muted mr-2" rel="tag" href="/tags/Personalized-Ranking/">Personalized Ranking</a><a class="link-muted mr-2" rel="tag" href="/tags/Implicit-Feedback/">Implicit Feedback</a></div><div class="a2a_kit a2a_kit_size_32 a2a_default_style"><a class="a2a_dd" target="_blank" rel="noopener" href="https://www.addtoany.com/share"></a><a class="a2a_button_facebook"></a><a class="a2a_button_twitter"></a><a class="a2a_button_telegram"></a><a class="a2a_button_whatsapp"></a><a class="a2a_button_reddit"></a></div><script src="https://static.addtoany.com/menu/page.js" defer></script></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2021/04/03/Understanding-Bilibili-s-Business-Model/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">Understanding Bilibili&#039;s Business Model</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2020/04/21/Yihong-MIS-Reading-List/"><span class="level-item">Yihong&#039;s MIS Ph.D. Reading List</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">Comments</h3><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div><script>var disqus_config = function () {
            this.page.url = 'https://blog.yihong-liu.com/2020/06/26/Understanding-BPR-COFISET-and-BPRH/';
            this.page.identifier = '2020/06/26/Understanding-BPR-COFISET-and-BPRH/';
        };
        (function() {
            var d = document, s = d.createElement('script');  
            s.src = '//' + 'liu-yihong-github-io' + '.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1 is-sticky"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/img/avatar.webp" alt="Yihong Liu, PhD"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Yihong Liu, PhD</p><p class="is-size-6 is-block">Assistant Professor @ UNI</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Cedar Falls, IA, USA</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">12</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">13</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">35</p></a></div></div></nav><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Email Me" href="mailto:%79%69%68%6F%6E%67%2E%6C%69%75%40%75%74%64%61%6C%6C%61%73%2E%65%64%75"><i class="fas fa-envelope-open-text"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/liu-yihong"><i class="fab fa-github-alt"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="LinkedIn" href="https://www.linkedin.com/in/yihong-liu2015"><i class="fab fa-linkedin"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="ORCiD" href="https://orcid.org/0000-0002-4055-3051"><i class="fab fa-orcid"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Google Scholar" href="/"><i class="fas fa-graduation-cap"></i></a></div></div></div><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">Catalogue</h3><ul class="menu-list"><li><a class="level is-mobile" href="#TODO"><span class="level-left"><span class="level-item">1</span><span class="level-item">TODO</span></span></a></li><li><a class="level is-mobile" href="#BPR"><span class="level-left"><span class="level-item">2</span><span class="level-item">BPR</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Implementation"><span class="level-left"><span class="level-item">2.1</span><span class="level-item">Implementation</span></span></a></li></ul></li><li><a class="level is-mobile" href="#COFISET"><span class="level-left"><span class="level-item">3</span><span class="level-item">COFISET</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Item-sets-and-Pairwise-Preferences"><span class="level-left"><span class="level-item">3.1</span><span class="level-item">Item-sets and Pairwise Preferences</span></span></a></li><li><a class="level is-mobile" href="#Objective-Function-and-Optimization"><span class="level-left"><span class="level-item">3.2</span><span class="level-item">Objective Function and Optimization</span></span></a></li><li><a class="level is-mobile" href="#Corresponding-Gradients-in-SGD"><span class="level-left"><span class="level-item">3.3</span><span class="level-item">Corresponding Gradients in SGD</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Updating-Rules"><span class="level-left"><span class="level-item">3.3.1</span><span class="level-item">Updating Rules</span></span></a></li></ul></li><li><a class="level is-mobile" href="#JAVA-Implementation"><span class="level-left"><span class="level-item">3.4</span><span class="level-item">JAVA Implementation</span></span></a></li></ul></li><li><a class="level is-mobile" href="#BPRH"><span class="level-left"><span class="level-item">4</span><span class="level-item">BPRH</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Extended-Pairwise-Preferences"><span class="level-left"><span class="level-item">4.1</span><span class="level-item">Extended Pairwise Preferences</span></span></a></li><li><a class="level is-mobile" href="#Objective-Function-and-Optimization-1"><span class="level-left"><span class="level-item">4.2</span><span class="level-item">Objective Function and Optimization</span></span></a></li><li><a class="level is-mobile" href="#Corresponding-Gradients-in-SGD-1"><span class="level-left"><span class="level-item">4.3</span><span class="level-item">Corresponding Gradients in SGD</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Updating-Rules-1"><span class="level-left"><span class="level-item">4.3.1</span><span class="level-item">Updating Rules</span></span></a></li></ul></li><li><a class="level is-mobile" href="#Online-Updating-for-New-User"><span class="level-left"><span class="level-item">4.4</span><span class="level-item">Online Updating for New User</span></span></a></li><li><a class="level is-mobile" href="#Python-Implementation"><span class="level-left"><span class="level-item">4.5</span><span class="level-item">Python Implementation</span></span></a></li></ul></li><li><a class="level is-mobile" href="#Reference"><span class="level-left"><span class="level-item">5</span><span class="level-item">Reference</span></span></a></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/Ph-D/"><span class="level-start"><span class="level-item">Ph.D.</span></span><span class="level-end"><span class="level-item tag">12</span></span></a><ul><li><a class="level is-mobile" href="/categories/Ph-D/Courses/"><span class="level-start"><span class="level-item">Courses</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Ph-D/Job/"><span class="level-start"><span class="level-item">Job</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Ph-D/Notes/"><span class="level-start"><span class="level-item">Notes</span></span><span class="level-end"><span class="level-item tag">4</span></span></a><ul><li><a class="level is-mobile" href="/categories/Ph-D/Notes/Job/"><span class="level-start"><span class="level-item">Job</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/Ph-D/Notes/TA/"><span class="level-start"><span class="level-item">TA</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Ph-D/Reading/"><span class="level-start"><span class="level-item">Reading</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Ph-D/Research/"><span class="level-start"><span class="level-item">Research</span></span><span class="level-end"><span class="level-item tag">4</span></span></a><ul><li><a class="level is-mobile" href="/categories/Ph-D/Research/Conference/"><span class="level-start"><span class="level-item">Conference</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Ph-D/Research/Doctoral-Consortium/"><span class="level-start"><span class="level-item">Doctoral Consortium</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Ph-D/Writing/"><span class="level-start"><span class="level-item">Writing</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul><li><a class="level is-mobile" href="/categories/Ph-D/Writing/Latex/"><span class="level-start"><span class="level-item">Latex</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul><li><a class="level is-mobile" href="/categories/Ph-D/Writing/Latex/PGF-TikZ/"><span class="level-start"><span class="level-item">PGF/TikZ</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li></ul></li></ul></li></ul></div></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2023/"><span class="level-start"><span class="level-item">2023</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/"><span class="level-start"><span class="level-item">2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/"><span class="level-start"><span class="level-item">2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/"><span class="level-start"><span class="level-item">2020</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/"><span class="level-start"><span class="level-item">2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/Bilibili/"><span class="tag">Bilibili</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Business-Model/"><span class="tag">Business Model</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/B%E7%AB%99/"><span class="tag">B站</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Calendar/"><span class="tag">Calendar</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Conference/"><span class="tag">Conference</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Courses/"><span class="tag">Courses</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Doctoral-Consortium/"><span class="tag">Doctoral Consortium</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/IS/"><span class="tag">IS</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ITSS3300/"><span class="tag">ITSS3300</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Implicit-Feedback/"><span class="tag">Implicit Feedback</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Information-Systems/"><span class="tag">Information Systems</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Interview-Experiences/"><span class="tag">Interview Experiences</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/JSOM/"><span class="tag">JSOM</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Job/"><span class="tag">Job</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Latex/"><span class="tag">Latex</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/MIS/"><span class="tag">MIS</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Management-Information-Systems/"><span class="tag">Management Information Systems</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Math/"><span class="tag">Math</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Notes/"><span class="tag">Notes</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Online-Video-Community/"><span class="tag">Online Video Community</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/PGF-TikZ/"><span class="tag">PGF/TikZ</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Packages/"><span class="tag">Packages</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Personalized-Ranking/"><span class="tag">Personalized Ranking</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Ph-D/"><span class="tag">Ph.D.</span><span class="tag">10</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Preliminary/"><span class="tag">Preliminary</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Publications/"><span class="tag">Publications</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Reading/"><span class="tag">Reading</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Reflection/"><span class="tag">Reflection</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Research/"><span class="tag">Research</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SQL/"><span class="tag">SQL</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Video-Collaboration/"><span class="tag">Video Collaboration</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Writing/"><span class="tag">Writing</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%93%94%E5%93%A9%E5%93%94%E5%93%A9/"><span class="tag">哔哩哔哩</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%95%86%E4%B8%9A%E6%A8%A1%E5%9E%8B/"><span class="tag">商业模型</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E8%81%94%E5%90%88%E6%8A%95%E7%A8%BF/"><span class="tag">联合投稿</span><span class="tag">1</span></a></div></div></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">follow.it</h3><form action="https://api.follow.it/subscription-form/Ry9rUXd6MUpybW03TXhrSVRLbWR2amUySnYvaVNvWGVITm1ubDczclZRYzFOQ2hTaXlMT1Z4MktyZ0RTZVdXV0hxTE5TdnpSL25Kd1hXQyt1M0xnZm40MlppSzM5QXE3Rnk4RnVRalNyNCs1ejBPNU5uaE1MazQ3S1VkWExtNEd8cVgxVmtsZTlRVUlmNVlqT3lrOWsvbFFRY2NJK2drYmI5a0ZPcHhVeGF4az0=/8" method="post" target="_blank"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="Subscribe"></div></div><p class="help">Follow my blog!</p></form></div></div></div><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">Links</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://jindal.utdallas.edu/phd-students/yihong-liu" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Yihong&#039;s JSOM Profile</span></span><span class="level-right"><span class="level-item tag">jindal.utdallas.edu</span></span></a></li><li><a class="level is-mobile" href="https://blog.yihong-liu.com/MISReadingList/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">MIS Reading List</span></span><span class="level-right"><span class="level-item tag">blog.yihong-liu.com</span></span></a></li><li><a class="level is-mobile" href="https://blog.yihong-liu.com/MISReadingList/conferences/calendar/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">MIS Conference Calendar</span></span><span class="level-right"><span class="level-item tag">blog.yihong-liu.com</span></span></a></li><li><a class="level is-mobile" href="http://utdallas.edu/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">University of Texas at Dallas</span></span><span class="level-right"><span class="level-item tag">utdallas.edu</span></span></a></li><li><a class="level is-mobile" href="https://jindal.utdallas.edu/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Jindal School of Management</span></span><span class="level-right"><span class="level-item tag">jindal.utdallas.edu</span></span></a></li><li><a class="level is-mobile" href="http://english.sufe.edu.cn/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">SHUFE</span></span><span class="level-right"><span class="level-item tag">english.sufe.edu.cn</span></span></a></li><li><a class="level is-mobile" href="http://sime.shufe.edu.cn/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">SIME</span></span><span class="level-right"><span class="level-item tag">sime.shufe.edu.cn</span></span></a></li><li><a class="level is-mobile" href="http://riis.shufe.edu.cn/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">RIIS</span></span><span class="level-right"><span class="level-item tag">riis.shufe.edu.cn</span></span></a></li></ul></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo-2.png" alt="Yihong Liu&#039;s Blog" height="28"></a><p class="is-size-7"><span>&copy; 2025 Yihong Liu</span></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="NonCommercial 4.0 International" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><i class="fab fa-creative-commons-nc"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="ShareAlike 4.0 International" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><i class="fab fa-creative-commons-sa"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
            'HTML-CSS': {
                matchFontHeight: false
            },
            SVG: {
                matchFontHeight: false
            },
            CommonHTML: {
                matchFontHeight: false
            },
            tex2jax: {
                inlineMath: [
                    ['$','$'],
                    ['\\(','\\)']
                ]
            }
        });</script><script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.9/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>